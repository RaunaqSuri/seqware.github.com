<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>SeqWare › Developer Tutorial</title>
<meta content="nanoc 3.6.5" name="generator">
<link href="../../../assets/style-v17.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://feeds.feedburner.com/seqware" rel="alternate" title="The SeqWare Blog" type="application/atom+xml">
<script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34523087-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script>
<script type="text/javascript">         var disqus_shortname = 'seqware';          (function() {             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;             dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);         })();     </script>
</head>
<body>
<div class="wrapper">
<!-- ***** navigation ***** -->
<div class="nav">
<ol>
<li><a href="../../../"><span>Home</span></a></li>
<li><a href="../../../blog/"><span>News</span></a></li>
<li><a href="../../"><span>Documentation</span></a></li>
<li><a href="../../../community/"><span>Community</span></a></li>
<li><a href="../../../partners/"><span>Partners</span></a></li>
<li><a href="../../../about/"><span>About</span></a></li>
</ol>
</div>
<!-- ***** sidebar ***** -->
<div class="side">
<ol>
<li><a href="../../1-introduction/"><span>Introduction to SeqWare</span></a></li>
<li><a href="../../2-installation/"><span>Installation</span></a></li>
<li>
<a href="../"><span>Getting Started</span></a><ol class="toc">
<li><a href="#by-the-end-of-this-tutorial">By the End of This Tutorial</a></li>
<li><a href="#the-theory-behind-a-seqware-workflow-bundle">The Theory Behind a SeqWare Workflow Bundle</a></li>
<li><a href="#note-about-working-directory-vs-workflow-bundle-directory">Note About Working Directory vs. Workflow Bundle Directory</a></li>
<li><a href="#first-steps">First Steps</a></li>
<li><a href="#overview-of-workflow-development-using-the-vm">Overview of Workflow Development Using the VM</a></li>
<li><a href="#creating-a-new-workflow">Creating a New Workflow</a></li>
<li><a href="#a-tour-of-workflow-bundle-components">A Tour of Workflow Bundle Components</a></li>
</ol>
</li>
<li><a href="../../6-pipeline/"><span>SeqWare Pipeline</span></a></li>
<li><a href="../../4-metadb/"><span>SeqWare MetaDB</span></a></li>
<li><a href="../../5-portal/"><span>SeqWare Portal</span></a></li>
<li><a href="../../7-web-service/"><span>SeqWare Web Service</span></a></li>
<li><a href="../../8-query-engine/"><span>SeqWare Query Engine</span></a></li>
<li><a href="../../9-glossary/"><span>Glossary</span></a></li>
<li><a href="../../10-faq/"><span>Frequently Asked Questions</span></a></li>
<li><a href="../../11-api/"><span>APIs</span></a></li>
<li><a href="../../13-code/"><span>Source Code</span></a></li>
<li><a href="../../17-plugins/"><span>Plugins</span></a></li>
<li><a href="../../17a-modules/"><span>Modules</span></a></li>
</ol>
</div>
<!-- ***** body ***** -->
<div class="body">
<div class="article">
<div class="header">
<h1>Developer Tutorial</h1>
</div>
<!-- TODO 
* really, should be a tutorial for MyHelloWorld so it doesn't conflict with the workflow already installed
* the adding new job step below should show how to call a user-created script! A one-step workflow!
-->

<p>This guide picks up where the <a href="../user-tutorial/">User
Tutorial</a> left off. In that previous
guide we showed you how to start up your local VM, create studies, experiments,
and samples, associate an input file with a sample, and then launch a workflow
to process that file.  These workflows can be complex (they include branching
and looping) and in future tutorials you will see how to string multiple
workflows together (output of one as input for the next) using
<a href="../../6-pipeline/#deciders">deciders</a> for automation.</p>

<p>In this tutorial the focus is on creating a workflow of your own based on the
HelloWorld that comes bundled with the VM.  In theory you could use either a
local VM or an Amazon instance to follow the tutorial below but in our case we
will base it on the local VM.</p>

<div class="section" id="by-the-end-of-this-tutorial">
<h2>By the End of This Tutorial</h2>

<p>By the end of these tutorials you will:</p>

<ul>
  <li>create a new SeqWare Pipeline workflow bundle based on HelloWorld</li>
  <li>test your workflow bundle locally</li>
  <li>package your new workflow as a bundle for hand-off to an administrator for installation into SeqWare Pipeline </li>
</ul>

</div>
<div class="section" id="the-theory-behind-a-seqware-workflow-bundle">
<h2>The Theory Behind a SeqWare Workflow Bundle</h2>

<p>In many workflow environments the concept of a workflow is encoded as a simple
XML markup file that defines a series of steps, data inputs, etc. This may be
interpreted by a user interface of some sort, e.g. a drag-n-drop workflow
creation tool. These workflow systems tend to treat workflows as very
light-weigh representations of steps.  One problem with this lightweight
approach is dependencies for steps in the workflow, such as genome indexes for
an aligner, are often times treated as parameters and are not managed by the
workflow system.  SeqWare’s concept of a workflow is much more akin to a Linux
distribution package (like RPM or DEB files) in which all necessary components
are packaged inside a single binary file. In SeqWare we use Zip64 files to
group the workflow definition file, workflow itself, sample settings, and data
dependencies in a single file that can be exchanged between SeqWare users or
archived. This allows SeqWare bundles to be much more portable than lightweight
workflows that reference external tools and data. Being self-contained is at
the core of the design goals for SeqWare bundles with the expense of often
times large workflow bundle sizes.</p>

</div>
<div class="section" id="note-about-working-directory-vs-workflow-bundle-directory">
<h2>Note About Working Directory vs. Workflow Bundle Directory</h2>

<p>Just to be clear, there are two directory locations to consider when working
with workflows.  The workflow bundle directory (often referred to as
<tt>${workflow_bundle_dir}</tt> in various components) refers to the location
of the installed workflow bundle. You use this variable throughout your
workflow bundle to refer to the install directory since that will only be known
after the workflow bundle is installed.  For example, in the Java workflow
language you would refer to a script called <tt>foo.pl</tt> installed in the
<tt>bin</tt> directory within the workflow bundle as
<tt>this.getWorkflowBaseDir()+”/bin/foo.pl”</tt>.  Similarly, from inside the
workflow INI config file you can refer to a data file as
<tt>my_file=${workflow_bundle_dir}/data/data_file.txt</tt>.</p>

<p>The second directory is the current working directory. Every time a workflow is
launched, a temporary working directory is created for just that particular run
of the workflow.  A shared
filesystem (NFS, gluster, etc) is required to ensure each job in a workflow is
able to access this shared workflow working location regardless of what cluster
node is selected to run a particular job.  Before a job in a workflow executes
the current working directory is set so workflow authors can assume their
individual jobs are already in the correct location.</p>

</div>
<div class="section" id="first-steps">
<h2>First Steps</h2>

<p>Please launch your local VM in VirtualBox or cloud AMI on Amazon now.  For the
local VM, login as user <kbd>seqware</kbd>, password <kbd>seqware</kbd> at this
time. Click on the “SeqWare Directory” link on the desktop which will open a
terminal to the location where we installed the SeqWare tools.</p>

<p>Alternatively, on the Amazon AMI follow the directions to log in
<a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html">here</a>.
Make sure that you launch our VM with the “cc1.4xlarge” instance type.
Also, please wait roughly 10 minutes for our startup scripts to run and fully setup your instance.</p>

<p>Once logging into the remote instance you need to “switch user” to
<kbd>seqware</kbd>, e.g.:</p>

<pre><code>$ sudo su - seqware
</code></pre>

<p>Both the VirtualBox VM and Amazon AMI include a start page that links to key information
for the VM such as the URLs for the installed Portal, Web Service, key file locations, etc.
On the VirtualBox VM, just click the “Start Here” link on the desktop.  For the Amazon instance
use the instance name provided by the AWS console. For example, it will look similar to:</p>

<pre><code>http://ec2-54-224-22-195.compute-1.amazonaws.com
</code></pre>

<p>You fill in your instance DNS name from the Amazon console in place of ec2-54-224-22-195.compute-1.amazonaws.com above. Make sure you check your security group settings to ensure port 80 (and the other ports referenced in the landing page) are open.</p>

</div>
<div class="section" id="overview-of-workflow-development-using-the-vm">
<h2>Overview of Workflow Development Using the VM</h2>

<p>You should be in the <code>/home/seqware/</code> directory now.  Notice there are two important directories:
<code>provisioned-bundles</code> (<code>SW_BUNDLE_DIR</code> in the config) which contains unzipped
workflow bundles and <code>released-bundles</code>
(<code>SW_BUNDLE_REPO_DIR</code> in the config) which contains zip versions of the workflows
that you create when you package up these bundles and install them.</p>

<p>There are two ways to create a new workflow, the first is simply to copy an
existing workflow bundle from provisioned-bundles, rename it, and modify the
workflow to meet your needs. The second is using <a href="http://maven.apache.org/guides/introduction/introduction-to-archetypes.html">Maven
Archetypes</a>,
a template system which generates a workflow skeleton making it fast and easy
to get started with workflow development. In this tutorial we will use the
Maven Archetypes system here since it is fast and easy. We will also test the
new bundle and, once you finish, we will package it up, ready for handoff to an
admin that will install it in the SeqWare system so users can run it.</p>

<div class="section" id="common-steps">
<h3>Common Steps</h3>

<p>Most workflow developers follow a similar series of steps when developing new workflows. Generally one goes through the following process:</p>

<ul>
  <li>
    <dl>
      <dt>Plan your workflow</dt>
      <dd>Most developers are bioinformaticists and will spend some time exploring the tools and algorithms they want to use in this workflow and decide what problems their workflow is trying to solve.</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>Find your tools and sample data</dt>
      <dd>Tools are collected, synthetic or real test datasets are prepared, prototyping is done</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>Make and test the workflow</dt>
      <dd>The developer writes and tests the workflow both with bundled test data and real data locally and on a cluster or cloud resource</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>Packaging and handoff</dt>
      <dd>The developer zips up the finished workflow and hands off to an admin that installs the workflow so users can use it</dd>
    </dl>
  </li>
</ul>

</div>
</div>
<div class="section" id="creating-a-new-workflow">
<h2>Creating a New Workflow</h2>

<p>The SeqWare workflow archetype allows workflow developers to quickly create new
workflows. The Maven archetypes generate skeletons that contain a simple
example program that can be modified to create a new workflow. The archetypes
also take parameters prior to skeleton generation that allow the name of the
workflow to be specified and all configuration files to adjusted with respect
to these parameters.</p>

<p>The code generated by the archetype contains all the necessary files to
generate a complete workflow bundle when the <tt>mvn install</tt> command is
issued. This command will combine the workflow definition, the config file, the Java workflow file, and
other external dependencies pulled in by Maven to create a complete
workflow bundle. This makes the code  generated by the archetype ideal to place
under version control. As maintenance changes are made to the Java file or any
other aspect of the workflow, these files can be updated and a new workflow
reflecting these changes can be generated by re-issuing the  <tt>mvn
install</tt> command.</p>

<p>The first step to get started is to generate your workflow skeleton using Maven 
archetypes. You will want to do this in a directory without <code>pom.xml</code> files (i.e. 
outside of the SeqWare development directories).  Here we are working in the workflow-dev directory: </p>

<pre><code>$ cd ~/workflow-dev
$ mvn archetype:generate
...
829: local -&gt; com.github.seqware:seqware-archetype-decider (SeqWare Java Decider archetype)
830: local -&gt; com.github.seqware:seqware-archetype-java-workflow (SeqWare Java workflow archetype)
831: local -&gt; com.github.seqware:seqware-archetype-module (SeqWare module archetype)
Choose a number or apply filter (format: [groupId:]artifactId, case sensitive contains): 294: 
</code></pre>

<p class="warning"><strong>Note:</strong>You can inform Maven about the archetypes by downloading the latest <a href="https://github.com/SeqWare/seqware/releases/download/1.0.9/archetype-catalog.xml">archetype-catalog.xml</a> file and placing it in <code>~/.m2/</code>.</p>

<p>The numbers used to identify  the archetypes will vary 
depending on what you have installed, so you will need to scan through the list 
to find the SeqWare archetype you are looking for, in this case “SeqWare Java workflow archetype”.  Following the prompts, use “MyHelloWorld” as the artifactId and accept the defaults for the remaining by just pressing return.</p>

<p>Alternately, the archetype can be generated without any interaction:</p>

<pre><code>$ mvn archetype:generate \
  -DinteractiveMode=false \
  -DarchetypeCatalog=local \
  -DarchetypeGroupId=com.github.seqware \
  -DarchetypeArtifactId=seqware-archetype-java-workflow \
  -DgroupId=com.github.seqware \
  -DartifactId=workflow-MyHelloWorld \
  -Dworkflow-name=MyHelloWorld
</code></pre>

</div>
<div class="section" id="a-tour-of-workflow-bundle-components">
<h2>A Tour of Workflow Bundle Components</h2>

<p>In this section we will examine the internals of the Workflow Bundle that was just generated.
The first thing you should do is take a look at the workflow manifest showing which workflows
are present in this bundle (a single Workflow Bundle can contain many workflows).</p>

<pre><code>$ cd workflow-MyHelloWorld
$ mvn install
...
$ seqware bundle list --dir target/Workflow*

List Workflows:

 Workflow:
  Name: MyHelloWorld
  Version: 1.0
  Description: Add a description of the workflow here.
  Workflow Class: ${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/1.0/classes/com/github/seqware/MyHelloWorldWorkflow.java
  Config Path: ${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/1.0/config/MyHelloWorldWorkflow.ini
  Requirements Compute: single Memory: 20M Network: local
</code></pre>

<p>This shows the one workflow in the generated workflow bundle.</p>

<div class="section" id="directory-organization">
<h3>Directory Organization</h3>

<p>The directory structure created by the maven archetype includes a
<tt>pom.xml</tt> file which is our Maven build file, a <tt>src</tt> directory
which contains the Java workflow, and a workflow directory that contains any
bundled data, the basic workflow config file which includes all the parameters
this workflow accepts, the metadata.xml which defines the workflows available
in this bundle, and any scripts, binaries, or libraries your workflow needs (in
bin and lib respectively).</p>

<p>When you issue the <tt>mvn install</tt> command the <code>target</code> directory is created
which contains the compiled workflow along with the various necessary files all
correctly assembled in the proper directory structure.  You can 
run the workflow in test mode or package up the workflow as a zip file for
exchange with others. Both topics are covered later in this tutorial.</p>

<p>The Maven archetype workflows are quite nice, too, since it is easy to check in
everything but the target directory into source control like git or subversion.
This makes it a lot easier to share the development of workflows between
developers.</p>

<pre>
|-- pom.xml
|-- src
|   `-- main
|       `-- java
|           `-- com
|               `-- github
|                   `-- seqware
|                       `-- MyHelloWorldWorkflow.java
|-- target
|   `-- Workflow_Bundle_MyHelloWorld_1.0_SeqWare_1.0.9
|       `-- Workflow_Bundle_MyHelloWorld
|           `-- 1.0
|               |-- bin
|               |-- classes
|               |   `-- com
|               |       `-- github
|               |           `-- seqware
|               |               `-- MyHelloWorldWorkflow.class
|               |-- config
|               |   `-- MyHelloWorldWorkflow.ini
|               |-- data
|               |   `-- input.txt
|               |-- lib
|               |   `-- seqware-distribution-1.0.9-full.jar
|               `-- metadata.xml
|-- workflow
|   |-- config
|   |   `-- MyHelloWorldWorkflow.ini
|   |-- data
|   |   `-- input.txt
|   |-- lib
|   |-- metadata.xml
|   `-- workflows
`-- workflow.properties
</pre>

<p>Here are some additional details about these files:</p>

<ul>
  <li>
    <dl>
      <dt>pom.xml</dt>
      <dd>A maven project file. Edit this to change the version of the workflow and to add or modify workflow dependencies such as program, modules and data.</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>workflow</dt>
      <dd>This directory contains the workflow skeleton. Look in here to modify the workflow configuration and data files.</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>src</dt>
      <dd>This directory contains the Java client. Look in here to modify the .java files (Java workflow). The examples of Java workflows can be found <a href="../../15-workflow-examples/">here</a>.</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>workflow.properties</dt>
      <dd>You can edit the description and workflow names in this file.</dd>
    </dl>
  </li>
</ul>

</div>
<div class="section" id="workflow-manifest">
<h3>Workflow Manifest</h3>

<p>The workflow manifest (<tt>metadata.xml</tt>) includes the workflow name,
version, description, test command, and enough information so that the SeqWare
tools can test, execute, and install the workflow. Here is an example from the
MyHelloWorld workflow:</p>

<pre><code class="language-xml"><span class="nt">&lt;bundle</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;workflow</span> <span class="na">name=</span><span class="s">"MyHelloWorld"</span> <span class="na">version=</span><span class="s">"1.0"</span> <span class="na">seqware_version=</span><span class="s">"1.0.9"</span>
  <span class="na">basedir=</span><span class="s">"${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;description&gt;</span>Add a description of the workflow here.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;workflow_class</span> <span class="na">path=</span><span class="s">"${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/1.0/classes/com/github/seqware/MyHelloWorldWorkflow.java"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;config</span> <span class="na">path=</span><span class="s">"${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/1.0/config/MyHelloWorldWorkflow.ini"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;requirements</span> <span class="na">compute=</span><span class="s">"single"</span> <span class="na">memory=</span><span class="s">"20M"</span> <span class="na">network=</span><span class="s">"local"</span>  <span class="na">workflow_engine=</span><span class="s">"Pegasus,Oozie"</span> <span class="na">workflow_type=</span><span class="s">"java"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/workflow&gt;</span>
<span class="nt">&lt;/bundle&gt;</span></code></pre>

<p>As mentioned above, you can edit the description and workflow name in the workflow.properties file.</p>

</div>
<div class="section" id="workflow-java-class">
<h3>Workflow Java Class</h3>

<p>You can see the full Java workflow source code by looking at <a href="../../15-workflow-examples/">Workflow
Examples</a> or, in this case, just the
<tt>src/main/java/com/github/seqware/MyHelloWorldWorkflow.java</tt> file produced by the Maven Archetype above.</p>

<p>This Java class is pretty simple in its construction. It is used to define
input and output files along with the individual steps in the workflow and how
they relate to each other.  It is used to create a workflow object model which
is then handed of to a workflow engine that knows how to turn that into a
directed acyclic graph of jobs that can run on a cluster (local VM, an HPC
cluster, a cloud-based cluster, etc).</p>

<div class="section" id="files">
<h4>Files</h4>

<pre><code class="language-java">    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">SqwFile</span><span class="o">&gt;</span> <span class="n">setupFiles</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">try</span> <span class="o">{</span>
        <span class="c1">// register an plaintext input file using the information from the INI</span>
        <span class="c1">// provisioning this file to the working directory will be the first step in the workflow</span>
        <span class="n">SqwFile</span> <span class="n">file0</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">createFile</span><span class="o">(</span><span class="s">"file_in_0"</span><span class="o">);</span>
        <span class="n">file0</span><span class="o">.</span><span class="na">setSourcePath</span><span class="o">(</span><span class="n">getProperty</span><span class="o">(</span><span class="s">"input_file"</span><span class="o">));</span>
        <span class="n">file0</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">);</span>
        <span class="n">file0</span><span class="o">.</span><span class="na">setIsInput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

      <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
      <span class="o">}</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">getFiles</span><span class="o">();</span>
    <span class="o">}</span></code></pre>

<p>This method sets up files that are inputs for this workflow.  In
this example the input <tt>data/input.txt</tt> comes from the workflow bundle
itself. Here we pull in the information from the INI file using getProperty.</p>

<p>Output files are defined differently.</p>

<pre><code class="language-java">    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildWorkflow</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">...</span>

	<span class="n">Job</span> <span class="n">copyJob2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getWorkflow</span><span class="o">().</span><span class="na">createBashJob</span><span class="o">(</span><span class="s">"bash_cp"</span><span class="o">);</span>
	<span class="o">...</span>
        <span class="n">copyJob2</span><span class="o">.</span><span class="na">addFile</span><span class="o">(</span><span class="n">createOutputFile</span><span class="o">(</span><span class="s">"dir1/output"</span><span class="o">,</span> <span class="s">"txt/plain"</span><span class="o">,</span> <span class="n">manualOutput</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">SqwFile</span> <span class="nf">createOutputFile</span><span class="o">(</span><span class="n">String</span> <span class="n">workingPath</span><span class="o">,</span> <span class="n">String</span> <span class="n">metatype</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">manualOutput</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// register an output file</span>
        <span class="n">SqwFile</span> <span class="n">file1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SqwFile</span><span class="o">();</span>
        <span class="n">file1</span><span class="o">.</span><span class="na">setSourcePath</span><span class="o">(</span><span class="n">workingPath</span><span class="o">);</span>
        <span class="n">file1</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="n">metatype</span><span class="o">);</span>
        <span class="n">file1</span><span class="o">.</span><span class="na">setIsOutput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">file1</span><span class="o">.</span><span class="na">setForceCopy</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="c1">// if manual_output is set in the ini then use it to set the destination of this file</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">manualOutput</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">file1</span><span class="o">.</span><span class="na">setOutputPath</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getMetadata_output_file_prefix</span><span class="o">()</span> <span class="o">+</span> <span class="n">getMetadata_output_dir</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">workingPath</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">file1</span><span class="o">.</span><span class="na">setOutputPath</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getMetadata_output_file_prefix</span><span class="o">()</span> <span class="o">+</span> <span class="n">getMetadata_output_dir</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/"</span>
                <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"_"</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">getVersion</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">getRandom</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">workingPath</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">file1</span><span class="o">;</span>
    <span class="o">}</span></code></pre>

<p>The ultimate location of the output file is determined by two
parameters passed into the WorkflowLauncher which actually runs the workflow:
<tt>–metadata-output-file-prefix</tt> (our <tt>output_prefix</tt> in the ini
file) and <tt>–metadata-output-dir</tt> (or <tt>output_dir</tt> in the ini
file). Alternatively, you can actually override the output location for a file
as is the case with the above “manual_output”.  When this parameter is available
in the ini file the automatic location of the output file
(“output_prefix”+/+”output_dir”+/+”output”) is overridden to ensure the final output
path is unique.</p>

<p>The job that produces the output file is linked to that file by using job.addFile(SqwFile).</p>

</div>
<div class="section" id="directories">
<h4>Directories</h4>

<pre><code class="language-java">    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setupDirectory</span><span class="o">()</span> <span class="o">{</span>
	<span class="c1">// creates a dir1 directory in the current working directory where the workflow runs</span>
        <span class="k">this</span><span class="o">.</span><span class="na">addDirectory</span><span class="o">(</span><span class="s">"dir1"</span><span class="o">);</span>
    <span class="o">}</span></code></pre>

<p>This method sets up directories in the working directory that the workflow run in. In this case the workflow creates a directory called “dir1”.</p>

</div>
<div class="section" id="workflow-steps">
<h4>Workflow Steps</h4>

<pre><code class="language-java">    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildWorkflow</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// a simple bash job to call mkdir</span>
        <span class="c1">// note that this job uses the system's mkdir (which depends on the system being *nix)</span>
        <span class="n">Job</span> <span class="n">mkdirJob</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getWorkflow</span><span class="o">().</span><span class="na">createBashJob</span><span class="o">(</span><span class="s">"bash_mkdir"</span><span class="o">);</span>
        <span class="n">mkdirJob</span><span class="o">.</span><span class="na">getCommand</span><span class="o">().</span><span class="na">addArgument</span><span class="o">(</span><span class="s">"mkdir test1"</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">inputFilePath</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getFiles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"file_in_0"</span><span class="o">).</span><span class="na">getProvisionedPath</span><span class="o">();</span>

        <span class="c1">// a simple bash job to cat a file into a test file</span>
        <span class="c1">// the file is not saved to the metadata database</span>
        <span class="n">Job</span> <span class="n">copyJob1</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getWorkflow</span><span class="o">().</span><span class="na">createBashJob</span><span class="o">(</span><span class="s">"bash_cp"</span><span class="o">);</span>
        <span class="n">copyJob1</span><span class="o">.</span><span class="na">setCommand</span><span class="o">(</span><span class="n">catPath</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">inputFilePath</span> <span class="o">+</span> <span class="s">"&gt; test1"</span><span class="o">);</span>
        <span class="n">copyJob1</span><span class="o">.</span><span class="na">addParent</span><span class="o">(</span><span class="n">mkdirJob</span><span class="o">);</span>

        <span class="c1">// a simple bash job to echo to an output file and concat an input file</span>
        <span class="c1">// the file IS saved to the metadata database</span>
        <span class="n">Job</span> <span class="n">copyJob2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getWorkflow</span><span class="o">().</span><span class="na">createBashJob</span><span class="o">(</span><span class="s">"bash_cp"</span><span class="o">);</span>
        <span class="n">copyJob2</span><span class="o">.</span><span class="na">getCommand</span><span class="o">().</span><span class="na">addArgument</span><span class="o">(</span><span class="n">echoPath</span><span class="o">).</span><span class="na">addArgument</span><span class="o">(</span><span class="n">greeting</span><span class="o">).</span><span class="na">addArgument</span><span class="o">(</span><span class="s">" &gt; "</span><span class="o">).</span><span class="na">addArgument</span><span class="o">(</span><span class="s">"dir1/output"</span><span class="o">);</span>
        <span class="n">copyJob2</span><span class="o">.</span><span class="na">getCommand</span><span class="o">().</span><span class="na">addArgument</span><span class="o">(</span><span class="s">";"</span><span class="o">);</span>
        <span class="n">copyJob2</span><span class="o">.</span><span class="na">getCommand</span><span class="o">().</span><span class="na">addArgument</span><span class="o">(</span><span class="n">catPath</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span><span class="n">inputFilePath</span><span class="o">+</span> <span class="s">" &gt;&gt; dir1/output"</span><span class="o">);</span>
        <span class="n">copyJob2</span><span class="o">.</span><span class="na">addParent</span><span class="o">(</span><span class="n">mkdirJob</span><span class="o">);</span>
        <span class="n">copyJob2</span><span class="o">.</span><span class="na">addFile</span><span class="o">(</span><span class="n">createOutputFile</span><span class="o">(</span><span class="s">"dir1/output"</span><span class="o">,</span> <span class="s">"txt/plain"</span><span class="o">,</span> <span class="n">manualOutput</span><span class="o">));</span>

    <span class="o">}</span></code></pre>

<p>In this buildWorkflow() method three jobs are created.  You can see that the
<tt>createBashJob</tt> can be used to run any arbitrary command. In the future
we will add more job types (such as Map/Reduce for the Oozie engine).  Each
child job is linked to its parent using the <tt>addParent</tt> method.  This
information is enough to correctly schedule these jobs and run them in the
correct order locally on the VM, on an HPC cluster, or on the cloud.  The more
detailed Pipeline documentation will cover optional useful job methods
including examples of how to control memory requirements for particular jobs.</p>

<p class="warning"><strong>Tip:</strong>
It can be confusing at first but there are two directories to think about when
working with workflows.  The first is the ${workflow_bundle_dir} which is the
location where the workflow bundle has been unzipped. This variable can be used
both in the Java object (via the getWorkflowBaseDir() method) and the various
config and metadata files (via ${workflow_bundle_dir}). You use this to access
the location of data and other file types that you have included in the
workflow bundle.  The second directory is the current working directory that
your workflow steps will be executed in. This is a directory created at runtime
by the underlying workflow engine and is shared for all steps in your workflow.
You can use this as your temporary directory to process intermediate files.
</p>

</div>
</div>
<div class="section" id="configuration-file">
<h3>Configuration File</h3>

<p>Each workflow uses a simple INI file to record which variables it accepts,
their types, and default values.  For example:</p>

<pre><code class="language-ini"><span class="c1"># key=input_file:type=file:display=F:file_meta_type=text/plain</span>
<span class="na">input_file</span><span class="o">=</span><span class="s">${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/${workflow-version}/data/input.txt</span>
<span class="c1"># key=greeting:type=text:display=T:display_name=Greeting</span>
<span class="na">greeting</span><span class="o">=</span><span class="s">Testing</span>

<span class="na">cat</span><span class="o">=</span><span class="s">${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/${workflow-version}/bin/gnu-coreutils-5.67/cat</span>
<span class="na">echo</span><span class="o">=</span><span class="s">${workflow_bundle_dir}/Workflow_Bundle_MyHelloWorld/${workflow-version}/bin/gnu-coreutils-5.67/echo</span>

<span class="c1"># the output directory is a convention used in many workflows to specify a relative output path</span>
<span class="na">output_dir</span><span class="o">=</span><span class="s">seqware-results</span>
<span class="c1"># the output_prefix is a convention used to specify the root of the absolute output path or an S3 bucket name </span>
<span class="c1"># you should pick a path that is available on all cluster nodes and can be written by your user</span>
<span class="na">output_prefix</span><span class="o">=</span><span class="s">./</span>
<span class="c1"># manual output determines whether or not SeqWare should enforce the uniqueness of the final directory or not. </span>
<span class="c1"># If false, SeqWare places files in a directory specified by output_prefix/output_dir/workflowname_version/RANDOM/</span>
<span class="c1"># where RANDOM is an integer. If true, SeqWare places the files at output_prefix/output_dir and may overwrite existing</span>
<span class="c1"># files</span>
<span class="na">manual_output</span><span class="o">=</span><span class="s">false</span>


<span class="err">You</span> <span class="err">access</span> <span class="err">these</span> <span class="err">variables</span> <span class="err">in</span> <span class="err">the</span> <span class="err">Java</span> <span class="err">workflow</span> <span class="err">using</span> <span class="err">the</span>
<span class="err">getProperty()</span> <span class="err">method.</span> <span class="err">When</span> <span class="err">installing</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">the</span> <span class="err">ini</span> <span class="err">file</span> <span class="err">is</span>
<span class="err">parsed</span> <span class="err">and</span> <span class="err">extra</span> <span class="err">metadata</span> <span class="err">about</span> <span class="err">each</span> <span class="err">parameter</span> <span class="err">is</span> <span class="err">examined.</span> <span class="err">This</span> <span class="err">gives</span> <span class="err">the</span>
<span class="err">system</span> <span class="err">information</span> <span class="err">about</span> <span class="err">the</span> <span class="err">type</span> <span class="err">of</span> <span class="err">the</span> <span class="err">variable</span> <span class="err">(integer,</span> <span class="err">string,</span> <span class="err">etc)</span> <span class="err">and</span>
<span class="err">any</span> <span class="err">default</span> <span class="err">values.</span>

<span class="err">The</span> <span class="err">ini</span> <span class="err">file(s)</span> <span class="err">follow</span> <span class="err">the</span> <span class="err">general</span> <span class="err">pattern</span> <span class="err">of:</span>


<span class="c1"># comment/specification</span>
<span class="na">key</span><span class="o">=</span><span class="s">value</span>


<span class="err">To</span> <span class="err">achieve</span> <span class="err">this</span> <span class="err">overloaded</span> <span class="err">role</span> <span class="err">for</span> <span class="err">ini</span> <span class="err">files</span> <span class="err">you</span> <span class="err">need</span> <span class="err">to</span> <span class="err">include</span> <span class="err">hints</span> <span class="err">to</span>
<span class="err">ensure</span> <span class="err">the</span> <span class="err">BundleManager</span> <span class="err">that</span> <span class="err">installs</span> <span class="err">workflow</span> <span class="err">bundles</span> <span class="err">has</span> <span class="err">enough</span> <span class="err">information.</span>
<span class="err">Here</span> <span class="err">is</span> <span class="err">what</span> <span class="err">the</span> <span class="err">annotation</span> <span class="err">syntax</span> <span class="err">looks</span> <span class="err">like:</span>

    <span class="c1"># key=:type=[integer|float|text|pulldown|file]:display=[T|F][:display_name=][:file_meta_type=][:pulldown_items=|;|]</span>
    <span class="na">key</span><span class="o">=</span><span class="s">default_value</span>

<span class="na">The file_meta_type is only used for type</span><span class="o">=</span><span class="s">file.</span>

<span class="err">The</span> <span class="err">pulldown</span> <span class="err">type</span> <span class="err">means</span> <span class="err">that</span> <span class="err">the</span> <span class="err">pulldown_items</span> <span class="err">should</span> <span class="err">be</span> <span class="err">defined</span> <span class="err">as</span> <span class="err">well.</span> <span class="err">This</span> <span class="err">looks</span> <span class="err">like:</span>

    <span class="na">pulldown_items</span><span class="o">=</span><span class="s">|;|</span>

<span class="err">The</span> <span class="err">default</span> <span class="err">value</span> <span class="err">for</span> <span class="err">this</span> <span class="err">will</span> <span class="err">refer</span> <span class="err">to</span> <span class="err">either</span> <span class="err">value1</span> <span class="err">or</span> <span class="err">value2</span> <span class="err">above.</span>
<span class="err">If</span> <span class="err">you</span> <span class="err">fail</span> <span class="err">to</span> <span class="err">include</span> <span class="err">a</span> <span class="err">metadata</span> <span class="err">line</span> <span class="err">for</span> <span class="err">a</span> <span class="err">particular</span> <span class="err">key/value</span> <span class="err">then</span> <span class="err">it</span> <span class="err">is</span> <span class="err">assumed</span> <span class="err">to</span> <span class="err">be:</span>

    <span class="na">key</span><span class="o">=</span><span class="s">:type=text:display=F</span>

<span class="err">This</span> <span class="err">is</span> <span class="err">convenient</span> <span class="err">since</span> <span class="err">many</span> <span class="err">of</span> <span class="err">the</span> <span class="err">values</span> <span class="err">in</span> <span class="err">an</span> <span class="err">INI</span> <span class="err">file</span> <span class="err">should</span> <span class="err">not</span> <span class="err">be</span> <span class="err">displayed</span> <span class="err">to</span> <span class="err">the</span> <span class="err">end</span> <span class="err">user.</span>

<span class="c1">### Required INI Entries</span>

<span class="err">There</span> <span class="err">are</span> <span class="err">(currently)</span> <span class="err">two</span> <span class="err">required</span> <span class="err">entries</span> <span class="err">that</span> <span class="err">all</span> <span class="err">workflows</span> <span class="err">should</span> <span class="err">define</span>
<span class="err">in</span> <span class="err">their</span> <span class="err">ini</span> <span class="err">files.</span> <span class="err">These</span> <span class="err">are</span> <span class="err">related</span> <span class="err">to</span> <span class="err">output</span> <span class="err">file</span> <span class="err">provisioning.</span> <span class="err">In</span> <span class="err">your</span> <span class="err">workflow,</span>
<span class="err">if</span> <span class="err">you</span> <span class="err">produce</span> <span class="err">output</span> <span class="err">files</span> <span class="err">and</span> <span class="err">use</span> <span class="err">the</span> <span class="err">file</span> <span class="err">provisioning</span> <span class="err">mechanism</span> <span class="err">built</span> <span class="err">into</span>
<span class="err">workflows</span> <span class="err">these</span> <span class="err">two</span> <span class="err">entries</span> <span class="err">are</span> <span class="err">used</span> <span class="err">to</span> <span class="err">construct</span> <span class="err">the</span> <span class="err">output</span> <span class="err">location</span> <span class="err">for</span> <span class="err">the</span>
<span class="err">output</span> <span class="err">file.</span>

<span class="err">*</span> <span class="err">output_dir</span>
<span class="err">*</span> <span class="err">output_prefix</span>

<span class="err">For</span> <span class="err">example,</span> <span class="err">if</span> <span class="err">you</span> <span class="err">have</span> <span class="err">a</span> <span class="err">SqwFile</span> <span class="err">object</span> <span class="err">can</span> <span class="err">call</span>
<span class="err">file.setIsOutput(true)</span><span class="c1">; the workflow engine constructs an output path</span>
<span class="err">for</span> <span class="err">this</span> <span class="err">file</span> <span class="err">using</span> <span class="err">the</span> <span class="err">following:</span>

	<span class="err">//</span>

<span class="err">You</span> <span class="err">can</span> <span class="err">use</span> <span class="err">s3://bucketname/</span> <span class="err">or</span> <span class="err">a</span> <span class="err">local</span> <span class="err">path</span> <span class="err">as</span> <span class="err">the</span> <span class="err">prefix.</span>


<span class="err">Note:</span> <span class="err">While</span> <span class="err">the</span> <span class="err">above</span> <span class="err">entries</span> <span class="err">are</span> <span class="err">required,</span> <span class="err">it</span> <span class="err">is</span> <span class="err">STRONGLY</span> <span class="err">suggested</span> <span class="err">that</span> <span class="err">workflow</span> <span class="err">developers</span> <span class="err">no</span> <span class="err">longer</span> <span class="err">rely</span> <span class="err">on</span> <span class="err">them</span> <span class="err">to</span> <span class="err">decide</span> <span class="err">the</span> <span class="err">output</span> <span class="err">path</span> <span class="err">of</span> <span class="err">a</span> <span class="err">provisioned</span> <span class="err">file.</span>  <span class="err">Instead</span> <span class="err">we</span> <span class="err">recommend</span> <span class="err">explicitly</span> <span class="err">providing</span> <span class="err">in</span> <span class="err">the</span> <span class="err">ini</span> <span class="err">file</span> <span class="err">whatever</span> <span class="err">paths</span> <span class="err">you</span> <span class="err">may</span> <span class="err">require,</span> <span class="err">possibly</span> <span class="err">using</span> <span class="err">the</span> <span class="err">variables</span> <span class="err">described</span> <span class="err">below,</span> <span class="err">and</span> <span class="err">then</span> <span class="err">assigning</span> <span class="err">that</span> <span class="err">path</span> <span class="err">to</span> <span class="err">the</span> <span class="err">output</span> <span class="err">file</span> <span class="err">via</span> <span class="err">SqwFile.setOutputPath(String</span> <span class="err">path).</span>


<span class="c1">### INI Variables</span>

<span class="err">The</span> <span class="err">ini</span> <span class="err">files</span> <span class="err">support</span> <span class="err">variables,</span> <span class="err">in</span> <span class="err">the</span> <span class="err">format</span> <span class="err">`$(variable-name}`,</span> <span class="err">that</span> <span class="err">will</span> <span class="err">be</span> <span class="err">replaced</span> <span class="err">when</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">run</span> <span class="err">is</span> <span class="err">launched.</span> <span class="err">The</span> <span class="err">variable</span> <span class="err">name</span> <span class="err">can</span> <span class="err">refer</span> <span class="err">to</span> <span class="err">another</span> <span class="err">entry</span> <span class="err">in</span> <span class="err">the</span> <span class="err">ini</span> <span class="err">file,</span> <span class="err">or</span> <span class="err">can</span> <span class="err">refer</span> <span class="err">to</span> <span class="err">the</span> <span class="err">following</span> <span class="err">SeqWare</span> <span class="err">generated</span> <span class="err">values:</span>

<span class="err">*</span> <span class="err">`sqw.bundle-dir`:</span> <span class="err">the</span> <span class="err">path</span> <span class="err">to</span> <span class="err">the</span> <span class="err">directory</span> <span class="err">of</span> <span class="err">this</span> <span class="err">workflow's</span> <span class="err">bundle.</span> <span class="err">Support</span> <span class="err">for</span> <span class="err">the</span> <span class="err">legacy</span> <span class="err">version</span> <span class="err">of</span> <span class="err">this</span> <span class="err">variable,</span> <span class="err">`workflow_bundle_dir`,</span> <span class="err">may</span> <span class="err">be</span> <span class="err">removed</span> <span class="err">in</span> <span class="err">a</span> <span class="err">future</span> <span class="err">version.</span>
<span class="err">*</span> <span class="err">`sqw.date`:</span> <span class="err">the</span> <span class="err">current</span> <span class="err">date</span> <span class="err">in</span> <span class="err">ISO</span> <span class="err">8601</span> <span class="err">format,</span> <span class="err">e.g.,</span> <span class="err">2013-10-31.</span>  <span class="err">Support</span> <span class="err">for</span> <span class="err">the</span> <span class="err">legacy</span> <span class="err">version</span> <span class="err">of</span> <span class="err">this</span> <span class="err">variable,</span> <span class="err">`date`,</span> <span class="err">may</span> <span class="err">be</span> <span class="err">removed</span> <span class="err">in</span> <span class="err">a</span> <span class="err">future</span> <span class="err">version.</span>
<span class="err">*</span> <span class="err">`sqw.datetime`:</span> <span class="err">the</span> <span class="err">current</span> <span class="err">datetime</span> <span class="err">in</span> <span class="err">ISO</span> <span class="err">8601</span> <span class="err">format,</span> <span class="err">e.g.,</span> <span class="err">2013-10-31T16:45:30.</span>
<span class="err">*</span> <span class="err">`sqw.random`:</span> <span class="err">a</span> <span class="err">randomly</span> <span class="err">generated</span> <span class="err">integer</span> <span class="err">from</span> <span class="err">0</span> <span class="err">to</span> <span class="err">2147483647.</span>  <span class="err">Support</span> <span class="err">for</span> <span class="err">the</span> <span class="err">legacy</span> <span class="err">version</span> <span class="err">of</span> <span class="err">this</span> <span class="err">variable,</span> <span class="err">`random`,</span> <span class="err">may</span> <span class="err">be</span> <span class="err">removed</span> <span class="err">in</span> <span class="err">a</span> <span class="err">future</span> <span class="err">version.</span>
<span class="err">*</span> <span class="err">`sqw.timestamp`:</span> <span class="err">the</span> <span class="err">current</span> <span class="err">number</span> <span class="err">of</span> <span class="err">milliseconds</span> <span class="err">since</span> <span class="err">January</span> <span class="err">1,</span> <span class="err">1970.</span>
<span class="err">*</span> <span class="err">`sqw.uuid`:</span> <span class="err">a</span> <span class="err">randomly</span> <span class="err">generated</span> <span class="err">universally</span> <span class="err">unique</span> <span class="err">identifier.</span>

<span class="err">Each</span> <span class="err">instance</span> <span class="err">of</span> <span class="err">the</span> <span class="err">above</span> <span class="err">`sqw.*`</span> <span class="err">variables</span> <span class="err">in</span> <span class="err">an</span> <span class="err">ini</span> <span class="err">file</span> <span class="err">will</span> <span class="err">be</span> <span class="err">replaced</span> <span class="err">with</span> <span class="err">a</span> <span class="err">separately</span> <span class="err">resolved</span> <span class="err">value,</span> <span class="err">e.g.,</span> <span class="err">multiple</span> <span class="err">instances</span> <span class="err">of</span> <span class="err">`${sqw.uuid}`</span> <span class="err">will</span> <span class="err">each</span> <span class="err">resolve</span> <span class="err">to</span> <span class="err">different</span> <span class="err">values.</span> <span class="err">If</span> <span class="err">you</span> <span class="err">desire</span> <span class="err">to</span> <span class="err">reuse</span> <span class="err">the</span> <span class="err">same</span> <span class="err">generated</span> <span class="err">value,</span> <span class="err">do</span> <span class="err">somthing</span> <span class="err">akin</span> <span class="err">to</span> <span class="err">the</span> <span class="err">following:</span>

<span class="c1">#!ini</span>
<span class="na">dirname</span><span class="o">=</span><span class="s">output</span>
<span class="na">filename</span><span class="o">=</span><span class="s">${sqw.random}</span>
<span class="na">text_file</span><span class="o">=</span><span class="s">${dirname}/${filename}.txt</span>
<span class="na">json_file</span><span class="o">=</span><span class="s">${dirname}/${filename}.json</span>


<span class="err">Thus</span> <span class="err">if</span> <span class="err">`filename`</span> <span class="err">resolved</span> <span class="err">to</span> <span class="err">a</span> <span class="err">value</span> <span class="err">of</span> <span class="err">`12345`,</span> <span class="err">then</span> <span class="err">`text_file`</span> <span class="err">will</span> <span class="err">have</span> <span class="err">a</span> <span class="err">value</span> <span class="err">of</span> <span class="err">`output/12345.txt`</span> <span class="err">and</span> <span class="err">`json_file`</span> <span class="err">will</span> <span class="err">have</span> <span class="err">a</span> <span class="err">value</span> <span class="err">of</span> <span class="err">`output/12345.json`.</span>



<span class="c1">## Modifying the Workflow</span>

<span class="err">At</span> <span class="err">this</span> <span class="err">point,</span> <span class="err">one</span> <span class="err">would</span> <span class="err">normally</span> <span class="err">want</span> <span class="err">to</span> <span class="err">edit</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">by</span> <span class="err">modifying</span> <span class="err">the</span> <span class="err">MyHelloWorldWorkflow.java</span> <span class="err">file</span> <span class="err">as</span> <span class="err">is</span> <span class="err">appropriate</span> <span class="err">for</span> <span class="err">the</span> <span class="err">workflow.</span>
<span class="err">In</span> <span class="err">the</span> <span class="err">example</span> <span class="err">below</span> <span class="err">I</span> <span class="err">just</span> <span class="err">added</span> <span class="err">an</span> <span class="err">extra</span> <span class="err">job</span> <span class="err">that</span> <span class="err">does</span> <span class="err">a</span> <span class="err">simple</span> <span class="err">shell</span> <span class="err">operation</span> <span class="err">(dateJob).</span> <span class="err">I</span> <span class="err">also</span> <span class="err">moved</span> <span class="err">the</span> <span class="err">addFile</span> <span class="err">method</span> <span class="err">appropriately</span> <span class="err">since</span>
<span class="err">dateJob</span> <span class="err">is</span> <span class="err">now</span> <span class="err">the</span> <span class="err">final</span> <span class="err">job</span> <span class="err">that</span> <span class="err">manipulates</span> <span class="err">the</span> <span class="err">dir1/output</span> <span class="err">file.</span>


<span class="c1">#!java</span>
    <span class="err">@Override</span>
    <span class="err">public</span> <span class="err">void</span> <span class="err">buildWorkflow()</span> <span class="err">{</span>

        <span class="err">//</span> <span class="err">a</span> <span class="err">simple</span> <span class="err">bash</span> <span class="err">job</span> <span class="err">to</span> <span class="err">call</span> <span class="err">mkdir</span>
        <span class="err">//</span> <span class="err">note</span> <span class="err">that</span> <span class="err">this</span> <span class="err">job</span> <span class="err">uses</span> <span class="err">the</span> <span class="err">system's</span> <span class="err">mkdir</span> <span class="err">(which</span> <span class="err">depends</span> <span class="err">on</span> <span class="err">the</span> <span class="err">system</span> <span class="err">being</span> <span class="err">*nix)</span>
        <span class="na">Job mkdirJob</span> <span class="o">=</span> <span class="s">this.getWorkflow().createBashJob("bash_mkdir");</span>
<span class="s">        mkdirJob.getCommand().addArgument("mkdir test1");</span>

        <span class="na">String inputFilePath</span> <span class="o">=</span> <span class="s">this.getFiles().get("file_in_0").getProvisionedPath();</span>

        <span class="err">//</span> <span class="err">a</span> <span class="err">simple</span> <span class="err">bash</span> <span class="err">job</span> <span class="err">to</span> <span class="err">cat</span> <span class="err">a</span> <span class="err">file</span> <span class="err">into</span> <span class="err">a</span> <span class="err">test</span> <span class="err">file</span>
        <span class="err">//</span> <span class="err">the</span> <span class="err">file</span> <span class="err">is</span> <span class="err">not</span> <span class="err">saved</span> <span class="err">to</span> <span class="err">the</span> <span class="err">metadata</span> <span class="err">database</span>
        <span class="na">Job copyJob1</span> <span class="o">=</span> <span class="s">this.getWorkflow().createBashJob("bash_cp");</span>
<span class="s">        copyJob1.setCommand(catPath + " " + inputFilePath + "&gt; test1");</span>
<span class="s">        copyJob1.addParent(mkdirJob);</span>

        <span class="err">//</span> <span class="err">a</span> <span class="err">simple</span> <span class="err">bash</span> <span class="err">job</span> <span class="err">to</span> <span class="err">echo</span> <span class="err">to</span> <span class="err">an</span> <span class="err">output</span> <span class="err">file</span> <span class="err">and</span> <span class="err">concat</span> <span class="err">an</span> <span class="err">input</span> <span class="err">file</span>
        <span class="err">//</span> <span class="err">the</span> <span class="err">file</span> <span class="err">IS</span> <span class="err">saved</span> <span class="err">to</span> <span class="err">the</span> <span class="err">metadata</span> <span class="err">database</span>
        <span class="na">Job copyJob2</span> <span class="o">=</span> <span class="s">this.getWorkflow().createBashJob("bash_cp");</span>
<span class="s">        copyJob2.getCommand().addArgument(echoPath).addArgument(greeting).addArgument(" &gt; ").addArgument("dir1/output");</span>
<span class="s">        copyJob2.getCommand().addArgument(";");</span>
<span class="s">        copyJob2.getCommand().addArgument(catPath + " " +inputFilePath+ " &gt;&gt; dir1/output");</span>
<span class="s">        copyJob2.addParent(mkdirJob);</span>

	<span class="na">Job dateJob</span> <span class="o">=</span> <span class="s">this.getWorkflow().createBashJob("date");</span>
<span class="s">	dateJob.setCommand("date &gt;&gt; dir1/output");</span>
<span class="s">	dateJob.addParent(copyJob2);</span>
<span class="s">        dateJob.addFile(createOutputFile("dir1/output", "txt/plain", manualOutput));</span>
<span class="s">    }</span>






<span class="c1">## Building the Workflow</span>

<span class="err">If</span> <span class="err">you</span> <span class="err">made</span> <span class="err">changes</span> <span class="err">to</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">files</span> <span class="err">now</span> <span class="err">would</span> <span class="err">be</span> <span class="err">a</span> <span class="err">good</span> <span class="err">time</span> <span class="err">to</span> <span class="err">to</span> <span class="err">use</span>
<span class="err">"mvn</span> <span class="err">clean</span> <span class="err">install"</span> <span class="err">to</span> <span class="err">refresh</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">bundle</span> <span class="err">in</span> <span class="err">the</span> <span class="err">target</span> <span class="err">directory.</span> <span class="err">For</span>
<span class="err">example:</span>

        <span class="err">$</span> <span class="err">cd</span> <span class="err">~/workflow-dev/workflow-MyHelloWorld/</span>
        <span class="err">$</span> <span class="err">mvn</span> <span class="err">clean</span> <span class="err">install</span>
        <span class="err">[INFO]</span> <span class="err">Scanning</span> <span class="err">for</span> <span class="err">projects...</span>
        <span class="err">...</span>
        <span class="err">[INFO]</span> <span class="err">------------------------------------------------------------------------</span>
        <span class="err">[INFO]</span> <span class="err">BUILD</span> <span class="err">SUCCESS</span>
        <span class="err">[INFO]</span> <span class="err">------------------------------------------------------------------------</span>
        <span class="err">[INFO]</span> <span class="err">Total</span> <span class="err">time:</span> <span class="err">40.100s</span>
        <span class="err">[INFO]</span> <span class="err">Finished</span> <span class="err">at:</span> <span class="err">Thu</span> <span class="err">Aug</span> <span class="err">15</span> <span class="err">19:59:22</span> <span class="err">UTC</span> <span class="err">2013</span>
        <span class="err">[INFO]</span> <span class="err">Final</span> <span class="err">Memory:</span> <span class="err">28M/67M</span>
        <span class="err">[INFO]</span> <span class="err">------------------------------------------------------------------------</span>


<span class="c1">## Testing the Workflow</span>

<span class="err">During</span> <span class="err">the</span> <span class="err">launch</span> <span class="err">process,</span> <span class="err">a</span> <span class="err">number</span> <span class="err">of</span> <span class="err">files</span> <span class="err">are</span> <span class="err">generated</span> <span class="err">into</span> <span class="err">the</span> <span class="err">`generated-scripts`</span> <span class="err">directory</span> <span class="err">inside</span> <span class="err">the</span> <span class="err">run's</span> <span class="err">working</span> <span class="err">directory.</span>  <span class="err">For</span> <span class="err">each</span> <span class="err">job</span> <span class="err">in</span> <span class="err">a</span> <span class="err">workflow,</span> <span class="err">a</span> <span class="err">`.sh`</span> <span class="err">script</span> <span class="err">contains</span> <span class="err">the</span> <span class="err">content</span> <span class="err">of</span> <span class="err">the</span> <span class="err">associated</span> <span class="err">`BashJob`</span> <span class="err">defined</span> <span class="err">by</span> <span class="err">the</span> <span class="err">developer.</span>

<span class="err">When</span> <span class="err">using</span> <span class="err">the</span> <span class="err">Oozie-SGE</span> <span class="err">engine,</span> <span class="err">some</span> <span class="err">additional</span> <span class="err">files</span> <span class="err">are</span> <span class="err">included:</span>
<span class="err">*</span> <span class="err">`-runner.sh`:</span> <span class="err">The</span> <span class="err">script</span> <span class="err">invoked</span> <span class="err">by</span> <span class="err">SGE,</span> <span class="err">which</span> <span class="err">will</span> <span class="err">either</span> <span class="err">perform</span> <span class="err">a</span> <span class="err">file</span> <span class="err">provisioning</span> <span class="err">(copying</span> <span class="err">files</span> <span class="err">into/out</span> <span class="err">of</span> <span class="err">the</span> <span class="err">working</span> <span class="err">directory),</span> <span class="err">or</span> <span class="err">invoke</span> <span class="err">`.sh`</span>
<span class="err">*</span> <span class="err">`-qsub.opts`:</span> <span class="err">The</span> <span class="err">options</span> <span class="err">to</span> <span class="err">be</span> <span class="err">provided</span> <span class="err">to</span> <span class="err">the</span> <span class="err">`qsub`</span> <span class="err">command,</span> <span class="err">e.g.</span> <span class="err">setting</span> <span class="err">max</span> <span class="err">memory.</span>

<span class="err">Prior</span> <span class="err">to</span> <span class="err">testing</span> <span class="err">your</span> <span class="err">bundle,</span> <span class="err">it</span> <span class="err">will</span> <span class="err">be</span> <span class="err">worthwhile</span> <span class="err">to</span> <span class="err">ensure</span> <span class="err">that</span> <span class="err">the</span> <span class="err">files</span> <span class="err">generated</span> <span class="err">are</span> <span class="err">what</span> <span class="err">you</span> <span class="err">expect.</span>  <span class="err">You</span> <span class="err">can</span> <span class="err">accomplish</span> <span class="err">this</span> <span class="err">with</span> <span class="err">the</span> <span class="err">`dry-run`</span> <span class="err">command:</span>

    <span class="err">$</span> <span class="err">seqware</span> <span class="err">bundle</span> <span class="err">dry-run</span> <span class="err">--dir</span> <span class="err">target/Workflow_Bundle_*</span>
    <span class="err">Performing</span> <span class="err">dry-run</span> <span class="err">of</span> <span class="err">workflow</span> <span class="err">'MyHelloWorld'</span> <span class="err">version</span> <span class="err">'1.0'</span>
    <span class="err">Using</span> <span class="err">working</span> <span class="err">directory:</span> <span class="err">/usr/tmp/seqware-oozie/oozie-3d971491-ca43-48fb-a5d8-a73e18e7db44</span>
    <span class="err">Files</span> <span class="err">copied</span> <span class="err">to</span> <span class="err">hdfs://master:8020/user/seqware/seqware_workflow/oozie-3d971491-ca43-48fb-a5d8-a73e18e7db44</span>

    <span class="err">$</span> <span class="err">ls</span> <span class="err">/usr/tmp/seqware-oozie/oozie-3d971491-ca43-48fb-a5d8-a73e18e7db44</span>
    <span class="err">bash_cp_4.sh</span>  <span class="err">bash_cp_5.sh</span>  <span class="err">bash_mkdir_3.sh</span>  <span class="err">start_0.sh</span>

<span class="err">In</span> <span class="err">the</span> <span class="err">above,</span> <span class="err">`/usr/tmp/seqware-oozie`</span> <span class="err">is</span> <span class="err">the</span> <span class="err">configured</span> <span class="err">location</span> <span class="err">of</span> <span class="err">`OOZIE_WORK_DIR`.</span> <span class="err">Each</span> <span class="err">of</span> <span class="err">the</span> <span class="err">scripts</span> <span class="err">represents</span> <span class="err">a</span> <span class="err">bash</span> <span class="err">job</span> <span class="err">specified</span> <span class="err">by</span> <span class="err">the</span> <span class="err">developer,</span> <span class="err">with</span> <span class="err">the</span> <span class="err">exception</span> <span class="err">of</span> <span class="err">`start_0.sh`</span> <span class="err">which</span> <span class="err">creates</span> <span class="err">the</span> <span class="err">directories</span> <span class="err">specified</span> <span class="err">in</span> <span class="err">the</span> <span class="err">workflow's</span> <span class="err">`setupDirectory()`</span> <span class="err">method.</span>

<span class="err">At</span> <span class="err">this</span> <span class="err">point,</span> <span class="err">the</span> <span class="err">individual</span> <span class="err">scripts</span> <span class="err">can</span> <span class="err">be</span> <span class="err">executed</span> <span class="err">to</span> <span class="err">ensure</span> <span class="err">they</span> <span class="err">do</span> <span class="err">what</span> <span class="err">you</span> <span class="err">expect.</span>

<span class="err">The</span> <span class="err">next</span> <span class="err">step</span> <span class="err">after</span> <span class="err">authoring</span> <span class="err">your</span> <span class="err">workflows</span> <span class="err">in</span> <span class="err">the</span> <span class="err">Java</span> <span class="err">workflow</span> <span class="err">language,</span> <span class="err">and</span> <span class="err">verifying</span> <span class="err">the</span> <span class="err">generated</span> <span class="err">scripts,</span> <span class="err">is</span> <span class="err">to</span> <span class="err">run</span> <span class="err">them:</span>

    <span class="err">$</span> <span class="err">seqware</span> <span class="err">bundle</span> <span class="err">launch</span> <span class="err">--dir</span> <span class="err">target/Workflow_Bundle_*</span>
    <span class="err">Performing</span> <span class="err">launch</span> <span class="err">of</span> <span class="err">workflow</span> <span class="err">'MyHelloWorld'</span> <span class="err">version</span> <span class="err">'1.0'</span>
    <span class="err">Using</span> <span class="err">working</span> <span class="err">directory:</span> <span class="err">/usr/tmp/seqware-oozie/oozie-eccfb3b6-cda5-46c3-89ce-7839d4210531</span>
    <span class="err">Files</span> <span class="err">copied</span> <span class="err">to</span> <span class="err">hdfs://master:8020/user/seqware/seqware_workflow/oozie-eccfb3b6-cda5-46c3-89ce-7839d4210531</span>
    <span class="err">Submitted</span> <span class="err">Oozie</span> <span class="err">job:</span> <span class="err">0000001-130930203123321-oozie-oozi-W</span>

    <span class="err">Polling</span> <span class="err">workflow</span> <span class="err">run</span> <span class="err">status</span> <span class="err">every</span> <span class="err">10</span> <span class="err">seconds.</span>
    <span class="err">Terminating</span> <span class="err">this</span> <span class="err">program</span> <span class="err">will</span> <span class="err">NOT</span> <span class="err">affect</span> <span class="err">the</span> <span class="err">running</span> <span class="err">workflow.</span>

    <span class="err">Workflow</span> <span class="err">job</span> <span class="err">running</span> <span class="err">...</span>
    <span class="err">Application</span> <span class="err">Path</span>   <span class="err">:</span> <span class="err">hdfs://master:8020/user/seqware/seqware_workflow/oozie-eccfb3b6-cda5-46c3-89ce-7839d4210531</span>
    <span class="err">Application</span> <span class="err">Name</span>   <span class="err">:</span> <span class="err">MyHelloWorld</span>
    <span class="err">Application</span> <span class="err">Status</span> <span class="err">:</span> <span class="err">RUNNING</span>
    <span class="err">Application</span> <span class="err">Actions:</span>
       <span class="err">Name:</span> <span class="err">:start:</span> <span class="err">Type:</span> <span class="err">:START:</span> <span class="err">Status:</span> <span class="err">OK</span>
       <span class="err">Name:</span> <span class="err">start_0</span> <span class="err">Type:</span> <span class="err">java</span> <span class="err">Status:</span> <span class="err">RUNNING</span>
    <span class="err">...</span>


<span class="err">The</span> <span class="err">above</span> <span class="err">will</span> <span class="err">bypass</span> <span class="err">the</span> <span class="err">whole</span> <span class="err">workflow</span> <span class="err">scheduling</span> <span class="err">and</span> <span class="err">asynchronous</span> <span class="err">launching</span> <span class="err">process</span> <span class="err">that</span> <span class="err">you</span> <span class="err">saw</span> <span class="err">in</span> <span class="err">the</span> <span class="err">User</span> <span class="err">Tutorial.</span> <span class="err">What</span> <span class="err">you</span> <span class="err">lose</span> <span class="err">is</span> <span class="err">the</span> <span class="err">metadata</span> <span class="err">tracking</span> <span class="err">functionality.</span> <span class="err">The</span> <span class="err">command</span> <span class="err">runs</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">which</span> <span class="err">produces</span> <span class="err">file</span> <span class="err">outputs</span> <span class="err">but</span> <span class="err">that</span> <span class="err">is</span> <span class="err">all,</span> <span class="err">no</span> <span class="err">record</span> <span class="err">of</span> <span class="err">the</span> <span class="err">run</span> <span class="err">will</span> <span class="err">be</span> <span class="err">recorded</span> <span class="err">in</span> <span class="err">the</span> <span class="err">MetaDB.</span>

<span class="c1">### Running with the Oozie-SGE Workflow Engine</span>

<span class="err">By</span> <span class="err">default</span> <span class="err">workflows</span> <span class="err">are</span> <span class="err">executed</span> <span class="err">on</span> <span class="err">the</span> <span class="err">[Oozie](http://oozie.apache.org/)</span> <span class="err">workflow</span> <span class="err">engine,</span> <span class="err">with</span> <span class="err">each</span> <span class="err">step</span> <span class="err">treated</span> <span class="err">as</span> <span class="err">a</span> <span class="err">MapReduce</span> <span class="err">job.</span>
<span class="err">In</span> <span class="err">the</span> <span class="err">future,</span> <span class="err">using</span> <span class="err">this</span> <span class="err">workflow</span> <span class="err">engine</span> <span class="err">will</span> <span class="err">allow</span> <span class="err">for</span> <span class="err">mixed</span> <span class="err">workflows</span> <span class="err">that</span>
<span class="err">include</span> <span class="err">traditional</span> <span class="err">scripts</span> <span class="err">along</span> <span class="err">with</span> <span class="err">steps</span> <span class="err">using</span> <span class="err">MapReduce,</span> <span class="err">Pig,</span> <span class="err">Hive,</span> <span class="err">and</span>
<span class="err">other</span> <span class="err">Hadoop-associated</span> <span class="err">technologies.</span>

<span class="err">There</span> <span class="err">are</span> <span class="err">a</span> <span class="err">few</span> <span class="err">caveats</span> <span class="err">for</span> <span class="err">the</span> <span class="err">Oozie</span> <span class="err">workflow</span> <span class="err">engine</span> <span class="err">in</span> <span class="err">SeqWare.</span>  <span class="err">For</span> <span class="err">example,</span>
<span class="err">to</span> <span class="err">run</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">above</span> <span class="err">you</span> <span class="err">will</span> <span class="err">need</span> <span class="err">to</span> <span class="err">do</span> <span class="err">the</span> <span class="err">following:</span>

<span class="err">*</span> <span class="err">Ensure</span> <span class="err">your</span> <span class="err">.seqware/settings</span> <span class="err">file</span> <span class="err">includes</span> <span class="err">the</span> <span class="err">correct</span> <span class="err">parameters.</span> <span class="err">If</span> <span class="err">you</span> <span class="err">are</span> <span class="err">using</span> <span class="err">our</span> <span class="err">VM</span> <span class="err">this</span> <span class="err">will</span> <span class="err">be</span> <span class="err">true.</span>
<span class="err">*</span> <span class="err">Jobs</span> <span class="err">are</span> <span class="err">run</span> <span class="err">by</span> <span class="err">the</span> <span class="err">'mapred'</span> <span class="err">user</span> <span class="err">not</span> <span class="err">the</span> <span class="err">seqware</span> <span class="err">user</span> <span class="err">(this</span> <span class="err">is</span> <span class="err">not</span> <span class="err">the</span> <span class="err">case</span> <span class="err">with</span> <span class="err">oozie-sge,</span> <span class="err">mentioned</span> <span class="err">below).</span> <span class="err">So</span> <span class="err">when</span> <span class="err">you</span> <span class="err">author</span> <span class="err">and</span> <span class="err">run</span> <span class="err">workflows</span> <span class="err">make</span> <span class="err">sure</span> <span class="err">the</span> <span class="err">output</span> <span class="err">destination</span> <span class="err">can</span> <span class="err">be</span> <span class="err">written</span> <span class="err">to</span> <span class="err">by</span> <span class="err">mapred.</span> <span class="err">In</span> <span class="err">the</span> <span class="err">future</span> <span class="err">we</span> <span class="err">will</span> <span class="err">eliminate</span> <span class="err">this</span> <span class="err">constraint.</span>
<span class="err">*</span> <span class="err">Workflows</span> <span class="err">include</span> <span class="err">bash</span> <span class="err">jobs</span> <span class="err">but</span> <span class="err">in</span> <span class="err">the</span> <span class="err">future</span> <span class="err">we</span> <span class="err">will</span> <span class="err">add</span> <span class="err">other</span> <span class="err">Hadoop-specific</span> <span class="err">types</span> <span class="err">(e.g.</span> <span class="err">MapReduce).</span> <span class="err">For</span> <span class="err">now</span> <span class="err">these</span> <span class="err">are</span> <span class="err">not</span> <span class="err">implemented.</span>
<span class="err">*</span> <span class="err">The</span> <span class="err">monitoring</span> <span class="err">tools</span> <span class="err">for</span> <span class="err">Oozie</span> <span class="err">are</span> <span class="err">good,</span> <span class="err">but</span> <span class="err">check</span> <span class="err">out</span> <span class="err">Hue</span> <span class="err">for</span> <span class="err">even</span> <span class="err">better</span> <span class="err">interaction</span> <span class="err">(it</span> <span class="err">should</span> <span class="err">already</span> <span class="err">be</span> <span class="err">running</span> <span class="err">on</span> <span class="err">port</span> <span class="err">8888</span> <span class="err">on</span> <span class="err">the</span> <span class="err">VM).</span> <span class="err">You</span> <span class="err">can</span> <span class="err">monitor</span> <span class="err">and</span> <span class="err">debug</span> <span class="err">workflows</span> <span class="err">through</span> <span class="err">this</span> <span class="err">very</span> <span class="err">nice</span> <span class="err">web</span> <span class="err">interface.</span>
<span class="err">*</span> <span class="err">This</span> <span class="err">engine</span> <span class="err">will</span> <span class="err">only</span> <span class="err">work</span> <span class="err">on</span> <span class="err">the</span> <span class="err">1.0.0</span> <span class="err">release</span> <span class="err">of</span> <span class="err">SeqWare</span> <span class="err">or</span> <span class="err">newer.</span> <span class="err">The</span> <span class="err">0.13.6.x</span> <span class="err">and</span> <span class="err">earlier</span> <span class="err">releases</span> <span class="err">will</span> <span class="err">only</span> <span class="err">work</span> <span class="err">with</span> <span class="err">the</span> <span class="err">Pegasus</span> <span class="err">workflow</span> <span class="err">engine.</span>

<span class="err">We</span> <span class="err">also</span> <span class="err">provide</span> <span class="err">an</span> <span class="err">alternate</span> <span class="err">"engine"</span> <span class="err">that</span> <span class="err">will</span> <span class="err">allow</span> <span class="err">jobs</span> <span class="err">to</span> <span class="err">be</span> <span class="err">managed</span> <span class="err">and</span> <span class="err">scheduled</span> <span class="err">by</span> <span class="err">Oozie</span> <span class="err">but</span>
<span class="na">run on a traditional Sun Grid Engine (SGE) cluster.  For workflows that execute on SGE, either change the SeqWare settings file to specify `SW_DEFAULT_ENGINE</span><span class="o">=</span><span class="s">oozie-sge`, or add `--engine oozie-sge` to the command line.  Unlike the oozie engine, the oozie-sge engine will execute jobs as the submitting user.</span>

<span class="err">In</span> <span class="err">this</span> <span class="err">following</span> <span class="err">example</span> <span class="err">the</span> <span class="err">same</span> <span class="err">workflow</span> <span class="err">as</span> <span class="err">above</span> <span class="err">is</span> <span class="err">executed</span> <span class="err">with</span> <span class="err">the</span> <span class="err">oozie-sge</span> <span class="err">engine:</span>

    <span class="err">$</span> <span class="err">cd</span> <span class="err">/home/seqware/workflow-dev/workflow-MyHelloWorld</span>
    <span class="err">$</span> <span class="err">seqware</span> <span class="err">bundle</span> <span class="err">launch</span> <span class="err">--dir</span> <span class="err">target/Workflow_Bundle_*</span> <span class="err">--engine</span> <span class="err">oozie-sge</span>

<span class="err">This</span> <span class="err">will</span> <span class="err">cause</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">to</span> <span class="err">run</span> <span class="err">and</span> <span class="err">not</span> <span class="err">exit</span> <span class="err">until</span> <span class="err">it</span> <span class="err">finishes.</span>  <span class="err">You</span> <span class="err">can</span> <span class="err">also</span> <span class="err">monitor</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">using</span> <span class="err">the</span> <span class="err">Hue</span> <span class="err">web</span>
<span class="err">application</span> <span class="err">installed</span> <span class="err">at</span> <span class="err">http://hostname:8888/oozie/.</span> <span class="err">For</span> <span class="err">our</span> <span class="err">VMs</span> <span class="err">the</span> <span class="err">username</span>
<span class="err">and</span> <span class="err">password</span> <span class="err">are</span> <span class="err">"seqware".</span> <span class="err">This</span> <span class="err">is</span> <span class="err">a</span> <span class="err">great</span> <span class="err">way</span> <span class="err">to</span> <span class="err">monitor</span> <span class="err">and</span> <span class="err">debug</span> <span class="err">workflows,</span>
<span class="err">you</span> <span class="err">can</span> <span class="err">very</span> <span class="err">easily</span> <span class="err">get</span> <span class="err">to</span> <span class="err">the</span> <span class="err">logs</span> <span class="err">for</span> <span class="err">each</span> <span class="err">step,</span> <span class="err">for</span> <span class="err">example.</span>


<span class="c1">## Packaging the Workflow into a Workflow Bundle</span>

<span class="err">Assuming</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">above</span> <span class="err">worked</span> <span class="err">fine</span> <span class="err">the</span> <span class="err">next</span> <span class="err">step</span> <span class="err">is</span> <span class="err">to</span> <span class="err">package</span> <span class="err">it.</span>

    <span class="err">$</span> <span class="err">mkdir</span> <span class="err">~/packaged-bundles</span>
    <span class="err">$</span> <span class="err">seqware</span> <span class="err">bundle</span> <span class="err">package</span> <span class="err">--dir</span> <span class="err">target/Workflow_Bundle_*</span> <span class="err">--to</span> <span class="err">~/packaged-bundles/</span>
    <span class="err">Validating</span> <span class="err">Bundle</span> <span class="err">structure</span>
    <span class="err">Packaging</span> <span class="err">Bundle</span>
    <span class="err">Bundle</span> <span class="err">has</span> <span class="err">been</span> <span class="err">packaged</span> <span class="err">to</span> <span class="err">/home/seqware/packaged-bundles</span>

<span class="err">What</span> <span class="err">happens</span> <span class="err">here</span> <span class="err">is</span> <span class="err">the</span> <span class="err">Workflow_Bundle_MyHelloWorld_1.0_SeqWare_1.0.9</span> <span class="err">directory</span> <span class="err">is</span> <span class="err">zip'd</span> <span class="err">up</span> <span class="err">to</span> <span class="err">your</span> <span class="err">output</span> <span class="err">directory</span> <span class="err">(`~/packaged-bundles`)</span> <span class="err">and</span> <span class="err">that</span> <span class="err">can</span> <span class="err">be</span> <span class="err">provided</span> <span class="err">to</span> <span class="err">an</span> <span class="err">admin</span> <span class="err">for</span> <span class="err">installation.</span>

<span class="c1">## Next Steps</span>

<span class="err">The</span> <span class="err">next</span> <span class="err">step</span> <span class="err">is</span> <span class="err">the</span> <span class="err">[Admin</span> <span class="err">Tutorial](/docs/3-getting-started/admin-tutorial/)</span> <span class="err">which</span> <span class="err">will</span> <span class="err">show</span> <span class="err">you</span> <span class="err">how</span> <span class="err">to</span> <span class="err">install</span> <span class="err">the</span> <span class="err">workflow</span> <span class="err">created</span> <span class="err">above</span> <span class="err">so</span> <span class="err">other</span> <span class="err">users</span> <span class="err">can</span> <span class="err">call</span> <span class="err">it.</span></code></pre>
</div>
</div>
</div>
<p> </p>
<p> </p>
<div id="disqus_thread"></div>
</div>
</div>
<!-- ***** footer ***** -->
<div id="footer">
<p>SeqWare © 2007–2013 Brian O&#8217;Connor. SeqWare is released under the a <a rel="license" href="http://www.gnu.org/licenses/licenses.html">GNU GPL v3</a>. This site is built using the excellent <a href="http://nanoc.ws/">nanoc</a> tool and example site along with the <a href="http://www.fonts.info/info/press/free-fonts-for-font-face-embedding.htm">Graublau</a> and <a href="https://en.wikipedia.org/wiki/Gentium">Gentium</a> fonts.</p>
</div>
</body>
</html>