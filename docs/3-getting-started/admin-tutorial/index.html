<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>SeqWare › Admin Tutorial</title>
<meta content="nanoc 3.4.0" name="generator">
<link href="../../../assets/style-v17.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://feeds.feedburner.com/seqware" rel="alternate" title="The SeqWare Blog" type="application/atom+xml">
<script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34523087-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script>
</head>
<body>
<div class="wrapper">
<!-- ***** navigation ***** -->
<div class="nav">
<ol>
<li><a href="../../../"><span>Home</span></a></li>
<li><a href="../../../blog/"><span>News</span></a></li>
<li><a href="../../"><span>Documentation</span></a></li>
<li><a href="../../../community/"><span>Community</span></a></li>
<li><a href="../../../partners/"><span>Partners</span></a></li>
<li><a href="../../../about/"><span>About</span></a></li>
</ol>
</div>
<!-- ***** sidebar ***** -->
<div class="side">
<ol>
<li><a href="../../1-introduction/"><span>Introduction to SeqWare</span></a></li>
<li><a href="../../2-installation/"><span>Installation</span></a></li>
<li>
<a href="../"><span>Getting Started</span></a><ol class="toc">
<li><a href="#by-the-end-of-these-tutorials">By the End of These Tutorials</a></li>
<li><a href="#how-to-launch">How to Launch</a></li>
<li><a href="#how-to-monitor">How to Monitor</a></li>
<li><a href="#how-to-recover-workflows">How to Recover Workflows</a></li>
<li><a href="#how-to-cancel-workflows">How to Cancel Workflows</a></li>
<li><a href="#how-to-clean-up">How to Clean-up</a></li>
<li><a href="#see-also">See Also</a></li>
<li><a href="#coming-soon">Coming Soon</a></li>
</ol>
</li>
<li><a href="../../4-metadb/"><span>SeqWare MetaDB</span></a></li>
<li><a href="../../5-portal/"><span>SeqWare Portal</span></a></li>
<li><a href="../../6-pipeline/"><span>SeqWare Pipeline</span></a></li>
<li><a href="../../7-web-service/"><span>SeqWare Web Service</span></a></li>
<li><a href="../../8-query-engine/"><span>SeqWare Query Engine</span></a></li>
<li><a href="../../9-glossary/"><span>Glossary</span></a></li>
<li><a href="../../10-faq/"><span>Frequently Asked Questions</span></a></li>
<li><a href="../../11-api/"><span>APIs</span></a></li>
<li><a href="../../13-code/"><span>Source Code</span></a></li>
<li><a href="../../17-plugins/"><span>Plugins</span></a></li>
</ol>
</div>
<!-- ***** body ***** -->
<div class="body">
<div class="article">
<div class="header">
<h1>Admin Tutorial</h1>
</div>
<p><strong>This guide is a work in progress.</strong>
This guide will, in the near future, focus on how to setup SeqWare at your site or on the cloud.
It focuses on what you need to do to get “real” work done e.g. to run workflows you create on
datasets that require multiple nodes to analyze the data in a reasonable amount of time.
There are basically two approaches for this, connect the VirtualBox VM to a cluster at your
local site or to launch a full SeqWare cluster on EC2 using Starcluster. Either of these
approaches will leave you with a system that can process large amounts of data. This guide
assumes you are an IT admin at your site or are working with an admin since some of the
steps will require “root” privileges.</p>

<div class="section" id="by-the-end-of-these-tutorials">
<h2>By the End of These Tutorials</h2>

<p>By the end of these tutorials you will:</p>

<ul>
<li>see how to connect a local VM to a local cluster for running large-scale workflows</li>
  <li>see how to launch a cluster on Amazon’s cloud for running large-scale workflows</li>
</ul>
</div>
<div class="section" id="how-to-launch">
<h2>How to Launch</h2>

<p>The <a href="../../17-plugins/#workflowlauncher">Workflow Launcher plugin</a> is responsible for scheduling workflow launches and launching them, both synchronously and asynchronously. In our reference SeqWare environment, we typically schedule jobs and then launch them asynchronously using the WorkflowLauncher  scheduled  via a cronjob. </p>

<p>Specifically, we schedule workflow launches using a command similar to that below:</p>

<pre><code>java -jar seqware-distribution-0.13.6.2-full.jar -p net.sourceforge.seqware.pipeline.plugins.WorkflowLauncher -- --ini-files workflow.ini --workflow-accession $workflow_acc --parent-accessions 99 --host `hostname --long` 
</code></pre>

<p>Then in a cronjob we use the following command to launch scheduled jobs. </p>

<pre><code>java -jar seqware-distribution-0.13.6.2-full.jar -p net.sourceforge.seqware.pipeline.plugins.WorkflowLauncher -- --launch-scheduled
</code></pre>

<p>Note that in the first command, we allow jobs to be scheduled on a specific host. When we launch scheduled workflows, we check this value in order to determine whether a particular scheduled workflow should be launchedi on this host.  A  –force-host option can be used to force launches to occur on a particular host. Note that while we normally use a fully qualified hostname, any unique string can be used to designate a host for launching  (for example on Amazon S3). </p>

</div>
<div class="section" id="how-to-monitor">
<h2>How to Monitor</h2>

<p>A cronjob that accompanies the launch-scheduled option of the WorkflowLauncher is the <a href="../../17-plugins/#workflowstatuschecker">Workflow Status Checker plugin</a>. This uses the pegasus-status command in order to retrieve the status of a currently running workflows and updates the MetaDB with their status. </p>

<div class="section" id="cron-jobs">
<h3>Cron Jobs</h3>

<p>The SeqWare VM uses two cron tasks to detect and launch scheduled workflows. Take a look at:</p>

<pre><code>seqware@seqwarevm SeqWare]$ crontab -l
1 0 * * * /home/seqware/crons/update_db.sh &gt;&gt; /home/seqware/logs/update_db.log
* * * * * /home/seqware/crons/status.cron &gt;&gt; /home/seqware/logs/status.log
</code></pre>

<p>The first script runs at one minute past midnight every night. This runs the stored procedures which populate the “Study Report” and the “SequenceRunReport” in the SeqWare Portal. 
The second script runs every minute. This script uses two plugins, the WorkflowLauncher plugin which is used to launch workflows that have been previously scheduled while the WorkflowStatusChecker plugin is used to check the status of launched workflows. </p>

</div>
<div class="section" id="workflow-run-reporter">
<h3>Workflow Run Reporter</h3>

<p>The Workflow Run Reporter is a command-line tool that will generated a tab-separated file containing information about one or more workflow runs. The workflow runs can either be retrieved according to time period, workflow type, or by workflow run SeqWare accession.</p>

<div class="section" id="requirements">
<h4>Requirements</h4>
<p>In order to run the WorkflowRunReporter plugin, you must have the following available to you:</p>

<ul>
<li>SeqWare Pipeline JAR (0.12.0 or higher)</li>
  <li>SeqWare settings file set up to contact the SeqWare Web service (contact your local SeqWare admin to get the path)</li>
</ul>
<p>If you are working on the SeqWare VM, these will already be setup for you. </p>

</div>
<div class="section" id="command-line-parameters">
<h4>Command line parameters</h4>

<p>There are three ways to retrieve data through this plugin</p>

<ul>
<li>Report a workflow_run by SWID - retrieves only that workflow_run</li>
  <li>Report all workflow_runs within a certain time period - according to the workflow_run create_tstmp</li>
  <li>Report all workflow_runs from a certain workflow, optionally by time period</li>
</ul>
<table>
<thead><tr>
<th>Command-line option</th>
      <th>Description</th>
    </tr></thead>
<tbody>
<tr>
<td>–workflow-run-accession</td>
      <td>the SWID of the workflow run</td>
    </tr>
<tr>
<td>–time-period</td>
      <td>Dates to check for workflow runs. Dates are in format YYYY-MM-DD. If one date is provided, from that point to the present is checked. If two, separated by hyphen YYYY-MM-DDL:YYYY-MM-DD then it checks that range</td>
    </tr>
<tr>
<td>–workflow-accession</td>
      <td>the SWID of a workflow. All the workflow runs for that workflow will be retrieved</td>
    </tr>
<tr>
<td>–stdout</td>
      <td>(0.12.5) Print the results to standard out instead of to a file</td>
    </tr>
<tr>
<td>-o, –output-filename</td>
      <td>(0.12.5) Optional: The output filename</td>
    </tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h4>Examples</h4>
<p>Retrieves the workflow run report of workflow_run SWID 24770:</p>

<pre><code>java -jar seqware-distribution/target/seqware-distribution-0.13.6-full.jar -p net.sourceforge.seqware.pipeline.plugins.WorkflowRunReporter -- --workflow-run-accession 24770
</code></pre>

<p>Retrieves the workflow run report of all workflows run between April 20 2012 and May 1 2012:</p>

<pre><code>java -jar seqware-distribution/target/seqware-distribution-0.13.6-full.jar -p net.sourceforge.seqware.pipeline.plugins.WorkflowRunReporter -- --time-period 2012-04-20:2012-05-01
</code></pre>

<p>Retrieves the workflow run reports for all runs of workflow SWID 23456 since Sept 1 2011:</p>

<pre><code>java -jar seqware-distribution/target/seqware-distribution-0.13.6-full.jar -p net.sourceforge.seqware.pipeline.plugins.WorkflowRunReporter -- --workflow-accession 62691 --time-period 2011-09-01
</code></pre>

<p>Retrieves the workflow run reports for all runs of workflow SWID 23456:</p>

<pre><code>java -jar seqware-distribution/target/seqware-distribution-0.13.6-full.jar -p net.sourceforge.seqware.pipeline.plugins.WorkflowRunReporter -- --workflow-accession 62691
</code></pre>

</div>
<div class="section" id="specification">
<h4>Specification</h4>

<p>Regardless of the command used to produce it, the file created by the plugin has the following information:</p>

<ul>
<li>Workflow name and version</li>
  <li>Workflow run SWID</li>
  <li>Workflow run status</li>
  <li>Workflow run status command</li>
  <li>Identity sample name and SWID (last in the sample hierarchy)</li>
  <li>Library sample name and SWID (root of the sample hierarchy)</li>
  <li>Input files: input files for a workflow run, with meta-type, SWID and file path</li>
  <li>Output files for a workflow run, with meta-type, SWID and file path</li>
  <li>Time spent on the run according to DB.</li>
</ul>
</div>
<div class="section" id="web-service-resources">
<h4>Web service resources</h4>
<p>These are the web service URIs that provide the data for the report. Although it is not necessary to understand these URLs to use the plugin, they can be used without the seqware-pipeline-x.x.x-full.jar to retrieve the report.</p>

<p>Examples:</p>

<ul>
<li>
<a href="http://localhost:8080/SeqWareWebService/reports/workflowruns/%7BSWID%7D">http://localhost:8080/SeqWareWebService/reports/workflowruns/{SWID}</a> - retrieves one workflow run</li>
  <li>
<a href="http://localhost:8080/SeqWareWebService/workflowruns">http://localhost:8080/SeqWareWebService/workflowruns</a> - retrieves all workflow runs. Can be filtered using the query parameters earliestdate and latestdate with the date in the format yyyyMMdd. e.g. ?earliestdate=20120101 to retrieve all workflow runs started after January 1, 2012.</li>
  <li>
<a href="http://localhost:8080/SeqWareWebService/reports/workflows/%7BSWID%7D/runs">http://localhost:8080/SeqWareWebService/reports/workflows/{SWID}/runs</a> - retrieves all workflow runs from a particular workflow. Can be filtered using the query parameters earliestdate and latestdate with the date in the format yyyyMMdd. e.g. ?earliestdate=20120101 to retrieve all workflow runs started after January 1, 2012.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="how-to-recover-workflows">
<h2>How to Recover Workflows</h2>

<div class="section" id="condor-brief">
<h3>Condor (brief)</h3>

</div>
</div>
<div class="section" id="how-to-cancel-workflows">
<h2>How to Cancel Workflows</h2>

</div>
<div class="section" id="how-to-clean-up">
<h2>How to Clean-up</h2>

</div>
<div class="section" id="see-also">
<h2>See Also</h2>

<p class="warning"><strong>Note:</strong>
Before proceeding further, it is worth noting that the SeqWare MetaDB should be regularly backed-up. 
On our deployment, we have a cron script which calls the SymLinkFileReporter and <code>pg_dump</code> nightly to do back-up. 
</p>

<p>Take a look at the guide for <a href="../../2a-installation-from-scratch/">creating a SeqWare VM</a> which provides technical details on how to install the components of the SeqWare software stack. </p>

</div>
<div class="section" id="coming-soon">
<h2>Coming Soon</h2>

<p>We are also preparing guides which will walk administrators through</p>

<ul>
<li>Hooking up to an SGE cluster (Pegasus)</li>
  <li>Hooking up to an Oozie cluster</li>
  <li>Hooking up to an LSF cluster</li>
</ul>
</div>
</div>
</div>
</div>
<!-- ***** footer ***** -->
<div id="footer">
<p>SeqWare © 2007–2012 Brian O&#8217;Connor. SeqWare is released under the a <a rel="license" href="http://www.gnu.org/licenses/licenses.html">GNU GPL v3</a>. This site is built using the excellent <a href="http://nanoc.stoneship.org/">nanoc</a> tool and example site along with the <a href="http://www.fonts.info/info/press/free-fonts-for-font-face-embedding.htm">Graublau</a> and <a href="http://scripts.sil.org/Gentium">Gentium</a> fonts.</p>
</div>
</body>
</html>
